<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="./js/sessao.js"></script>
    
    <link rel="shortcut icon" type="imagex/png" href="assets/img/ponyo-icone.png">
    <link rel="stylesheet" type="text/css" href="css/index.css" media="screen" />
    <title>Mundo Ponyo</title>
</head>
<body>
    <section id="inicio">
        <div class="video-container">
            <video autoplay muted loop class="bg-video">
                <source src="assets/videos/wallpaper-ponyo.mp4" type="video/mp4">
                Seu navegador não suporta esse arquivo de vídeo
            </video>
        </div>
        <div id="gradient-dark-top"></div>
        <div id="navbar" >
            <div id="nav_logo">
                <img src="assets//img/logo-mundo-ponyo.png" alt="Ponyo">
            </div>
            <div id="nav_links">
                <ul>
                    <li><a href="#inicio">Início</a></li>
                    <li><a href="#sobre_filme">Sobre o Filme</a></li>
                    <li><a href="#hayao_miyazaki">Hayao Miyazaki</a></li>
                    <li><a href="#galeria">Galeria</a></li>
                    <li><a href="#quiz">Quiz</a></li>
                    <li><a href="#jogo">Jogo</a></li>
                    <li><a href="#desenvolvedor">Desenvolvedor</a></li>
                </ul>
            </div>
            <div id="nav_buttons">
                <button id="btCadastro" class="bt_preenchido buttons" onclick="window.location.href='cadastro.html'">Cadastre-se</button>
                <button id="btLogin" class="bt_contorno buttons" onclick="window.location.href='login.html'">Login</button>
            </div>
        </div>
    </section>
    <section id="sobre_filme">Sobre o Filme</section>
    <section id="hayao_miyazaki">Hayao Miyazaki</section>
    <section id="galeria">Galeria
        <button id="btCadastro" class="bt_preenchido buttons" onclick="verificarLogin()">Ver mais</button>
    </section>
    <section id="quiz">Quiz</section>
    <section id="jogo">
        <div class="game_board">
            <div id="gradient-cenario"></div>
            <img src="assets/img/cenario-jogo-ponyo.png" class="cenario">
            <!-- <img src="assets/img/clouds.png" class="clouds"> -->
            <img src="assets/img/ponyo.gif" class="ponyo">
            <img src="assets/img/onda.gif" class="obstaculo">
            <div id="div_btIniciar">
                <button onclick="startGame()" id="start" class="bt_preenchido buttons btIniciar">INICIAR</button>
            </div>
        </div>
        <div class="game_over">
            <h1>Game Over</h1>
            <button onclick="restartGame()" id="restart" class="bt_preenchido buttons btReiniciar">Reiniciar</button>
        </div>
    </section>
    <section id="desenvolvedor">Desenvolvedor</section>
</body>
</html>

<script>
    //Faz com que o site faça a mudança de foma manual
    //Assim quando a pagina atualizar ele voltará ao topo do site
    //IMPEDINDO O SCROLL AUTOMÁTICO PARA AS DEMAIS SEÇÕES
    history.scrollRestoration = 'manual';

    
    //FIXA A NAVBAR NO TOP E PERMITE QUE COM A FUNÇÃO .SCROLLED
    //ALTEMAMOS O FUNDO DA NAVBAR
    window.addEventListener('scroll', function () {
        const navbar = document.getElementById('navbar');
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
            // nav_logotipo_soytrack.src = 'img/Logo-SoyTrack/logotipoSoyTrackCOLORIDA.png';
        } else {
            navbar.classList.remove('scrolled');
            // nav_logotipo_soytrack.src = 'img/Logo-SoyTrack/logotipoSoyTrackBRANCA.png';
        }
    });

    //VERIFICANDO SE O USUÁRIO ESTÁ LOGADO
    function verificarLogin() {
        var idUsuario = sessionStorage.getItem("ID_USUARIO");
        var email = sessionStorage.getItem("EMAIL_USUARIO");
        var nome = sessionStorage.getItem("NOME_USUARIO");

        // console.log(idUsuario + email +  nome);
        console.log(sessionStorage);
        if (sessionStorage.length <= 1) {
            alert('Para ver mais fotos, faça seu cadastro!');
            window.location.href='cadastro.html';
        } else {
            window.location.href='galeria.html';
        }
    }

    //JOGO
    const ponyo = document.querySelector('.ponyo');
    const obstaculo = document.querySelector('.obstaculo');
    const start = document.querySelector('#start');
    const gameOver = document.querySelector('.game_over');

    const jump = () => {
        ponyo.classList.add('jump');

        setTimeout(() => {
            ponyo.classList.remove('jump');
        }, 500);
    }

    const startGame = () => {

        obstaculo.style.display = 'flex';
        start.style.display = 'none';
        
        const loop = setInterval(() => {
            const obstaculoPosition = obstaculo.offsetLeft;
            const ponyoPosition = Number(window.getComputedStyle(ponyo).bottom.replace('px', ''));
            
            // obstaculo.getComputedStyle('.obstaculo-animation')
            
            console.log(obstaculoPosition);
            // console.log(ponyPosition)
            if (obstaculoPosition <= 90 && obstaculoPosition > 0 && ponyoPosition < 85) {

                gameOver.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                obstaculo.style.animation = 'none';
                obstaculo.style.left = `${obstaculoPosition}px`;
                
                ponyo.style.animation = 'none';
                ponyo.style.bottom = `${ponyoPosition}px`;
                
                ponyo.src = 'assets/img/ponyo-game-over.png';
                ponyo.style.width = '90px';
                ponyo.style.marginLeft = '20px';
                
                clearInterval(loop);
        } else {
            
        }
        }, 10);

    }

    //FUNÇÃO DE REINICIAR AINDA EM CONSTRUÇÃO
    const restartGame = () => {
        gameOver.style.display = 'none';
    
        // gameOver.style.display = 'flex';

        // obstaculo.style.animation = 'none';
        // obstaculo.style.marginLeft = ''
        // obstaculo.style.marginRight = '0'
        
        ponyo.src = 'assets/img/ponyo.gif';
        ponyo.style.width = '7.5%';
        ponyo.style.marginLeft = '0';
        ponyo.style.bottom = '0';

        // obstaculo.offsetHeight;
        obstaculo.style.animation = 'obstaculo-animation 2s infinite linear';
        obstaculo.style.display = 'flex';

        // clearInterval(loop);

        startGame();
    }

    document.addEventListener('keydown', jump);
</script>